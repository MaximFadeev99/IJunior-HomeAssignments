using System;
using System.Collections.Generic;

namespace CSTest2
{
    internal class Program
    {
        static void Main(string[] args)
        {
            const string CommandAddPlayer = "1";
            const string CommandRemovePlayer = "2";
            const string CommandBanPlayer = "3";
            const string CommandUnbanPlayer = "4";
            const string CommandExit = "5";

            Database mainDatabase = new Database();
            string commandOptions = $"\n{CommandAddPlayer} - добавить игрока" +
                $"\n{CommandRemovePlayer} - удалить игрока" +
                $"\n{CommandBanPlayer} - забанить игрока" +
                $"\n{CommandUnbanPlayer} - разбанить игрока" +
                $"\n{CommandExit} - выйти из базы данных";
            bool isWorking = true;
            string userInput;

            while (isWorking == true)
            {
                mainDatabase.ShowAllPlayers();
                Console.WriteLine(commandOptions);
                Console.WriteLine();
                Console.Write("Укажите команду:");
                userInput = Console.ReadLine();

                switch (userInput)
                {
                    case CommandAddPlayer:
                        mainDatabase.AddPlayer();
                        break;

                    case CommandRemovePlayer:
                        mainDatabase.RemovePlayer();
                        break;

                    case CommandBanPlayer:
                        mainDatabase.BanPlayer();
                        break;

                    case CommandUnbanPlayer:
                        mainDatabase.UnbanPlayer();
                        break;

                    case CommandExit:
                        isWorking = false;
                        break;

                    default:
                        Console.WriteLine("Неизвестная команда!");
                        break;
                }

                Console.ReadKey();
                Console.Clear();
            }
        }        
    }

    class Database
    {
        private List<Player> _database = new List<Player>();

        public Database()
        {
            AddInitialPlayers();
        }

        public void ShowAllPlayers()
        {
            Console.WriteLine("ID - Никнейм - Уровень - Статус аккаунта");

            foreach (Player player in _database)
            {
                Console.Write(player.UniqueId + " - " + player.NickName + " - " + player.Level + " - ");
                if (player.IsBanned == true)
                {
                    Console.Write("Забанен");
                }
                else
                {
                    Console.Write("Активный");
                }
                Console.WriteLine();
            }
        }

        public void AddPlayer()
        {
            string newPlayerName;
            Console.Write("Введите никнейм игрока: ");
            newPlayerName = Console.ReadLine();
            _database.Add(new Player(newPlayerName));
            Console.WriteLine("Новый игрок успешно добавлен!");
        }

        public void RemovePlayer()
        {
            EnquirePlayerId(out string playerID);
            _database.Remove(GetTargetPlayer(playerID));
            Console.WriteLine("Игрок успешно удален!");
        }

        public void BanPlayer()
        {
            EnquirePlayerId(out string playerID);
            GetTargetPlayer(playerID).BanPlayer();
            Console.WriteLine("Игрок забанен!");
        }

        public void UnbanPlayer()
        {
            EnquirePlayerId(out string playerID);
            GetTargetPlayer(playerID).UnbanPlayer();
            Console.WriteLine("Игрок разбанен!");
        }

        private void AddInitialPlayers() 
        {
            _database.Add(new Player("Лютик"));
            _database.Add(new Player("Геральт"));
            _database.Add(new Player("Цири"));
            _database.Add(new Player("Олаф"));
            _database.Add(new Player("Маки"));
        }

        private Player GetTargetPlayer(string playerID)
        {
            Player targetPlayer = new Player("");
            bool isFound = false;

            while (isFound == false)
            {
                foreach (var player in _database)
                {
                    if (player.UniqueId == playerID)
                    {
                        targetPlayer = player;
                        isFound = true;
                        break;
                    }
                }

                if (isFound == false)
                {
                    Console.WriteLine("Ошибка: Игрока с указанным ID номером не существует. Повторите ввод!");
                    EnquirePlayerId(out playerID);
                }
            }

            return targetPlayer;
        }

        private void EnquirePlayerId(out string playerID)
        {
            Console.Write("Введите ID игрока: ");
            playerID = Console.ReadLine();
        }
    }

    class Player
    {
        private static int _playersCount = 0;

        private string _idFixedPart = "plr";

        public Player(string nickName)
        {
            UniqueId = GenerateNewId();
            NickName = nickName;
        }

        public string UniqueId { get; private set; }
        public string NickName { get; private set; }
        public int Level { get; private set; } = 1;
        public bool IsBanned { get; private set; } = false;

        private string GenerateNewId()
        {
            string newId;
            newId = _idFixedPart + _playersCount;
            _playersCount++;
            return newId;
        }

        public void BanPlayer()
        {
            IsBanned = true;
        }

        public void UnbanPlayer()
        {
            IsBanned = false;
        }
    }
}
