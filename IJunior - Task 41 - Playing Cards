using System;
using System.Collections.Generic;

namespace CSTest2
{
    internal class Program
    {
        static void Main(string[] args)
        {
            const string CommandTakeCard = "1";
            const string CommandShowCards = "2";
            const string CommandExit = "3";

            PackOfCards packOfCards = new PackOfCards();
            Player player1 = new Player();
            string showCommands = $"{CommandTakeCard} - взять карту" +
                $"\n{CommandShowCards} - показать все карты" +
                $"\n{CommandExit} - выйти";
            string userInput;
            bool isLeaving = false;

            while (isLeaving == false)
            {
                Console.WriteLine(showCommands);
                Console.WriteLine($"\nКоличество карт на руках: {player1.CardsAtDisposal} / {player1.ShowMaxCards()}");
                Console.Write("\nУкажите команду:");
                userInput = Console.ReadLine();

                switch (userInput)
                {
                    case CommandTakeCard:
                        player1.TryTakeCard(packOfCards);
                        break;

                    case CommandShowCards:
                        player1.ShowCards();
                        break;

                    case CommandExit:
                        isLeaving = true;
                        break;

                    default:
                        Console.WriteLine("Ошибка: неизвестная команда!");
                        break;
                }

                Console.Clear();
            }
        }
    }

    class Player
    {
        private const int MaxCards  = 5;

        private List<Card> _playerCards = new List<Card>();

        public int CardsAtDisposal { get; private set; } = 0;

        public void TryTakeCard(PackOfCards packOfCards)
        {
            if (CardsAtDisposal < MaxCards)
            {
                _playerCards.Add(packOfCards.ChooseRandomCard());
                CardsAtDisposal++;
            }
            else
            {
                Console.WriteLine("У Вас на руках максимальное количетсво карт! Взять еще одну невозможно!");
                Console.ReadKey();
            }
        }

        public void ShowCards()
        {
            if (CardsAtDisposal != 0)
            {
                Console.WriteLine("\nВам выпали следующие карты:");

                foreach (var card in _playerCards)
                {
                    Console.WriteLine(card.Number + " " + card.Suit);
                }
            }
            else
            {
                Console.WriteLine("Вы не взяли ни одной карты!");
            }

            Console.ReadKey();
        }

        public int ShowMaxCards() 
        {
            return MaxCards;
        }
    }

    class PackOfCards
    {
        private static int SpadesCount = 1;
        private static int HeartsCount = 1;
        private static int DiamondsCount = 1;
        private static int ClubsCount = 1;

        private const string Spades = "Пики";
        private const string Hearts = "Черви";
        private const string Diamonds = "Бубны";
        private const string Clubs = "Трефы";
        private const int MaxCardsInOneSuit = 13;
        private const int MaxCardsInPack = 51;

        private List<Card> _packOfCards = new List<Card>();

        public PackOfCards()
        {
            while (_packOfCards.Count <= MaxCardsInPack)
            {
                GenerateCard(out int cardNumber, out string cardSuit, out bool isAvailable);
                _packOfCards.Add(new Card(cardNumber,cardSuit, isAvailable));
            }
        }

        public Card ChooseRandomCard()
        {
            Random random = new Random();
            Card randomCard = new Card(0,"",false);

            while (randomCard.IsAvailable != true)
            {
                randomCard = _packOfCards[random.Next(0, _packOfCards.Count)];
            }

            randomCard.MakeUnavailable();
            return randomCard;
        }

        private void GenerateCard(out int cardNumber, out string cardSuit, out bool isAvailable)
        {
            cardNumber = 0;
            cardSuit = string.Empty;
            isAvailable = false;

            if (SpadesCount <= MaxCardsInOneSuit)
            {
                cardSuit = Spades;
                cardNumber = SpadesCount;
                isAvailable = true;
                SpadesCount++;
            }
            else if (HeartsCount <= MaxCardsInOneSuit)
            {
                cardSuit = Hearts;
                cardNumber = HeartsCount;
                isAvailable = true;
                HeartsCount++;
            }
            else if (DiamondsCount <= MaxCardsInOneSuit)
            {
                cardSuit = Diamonds;
                cardNumber = DiamondsCount;
                isAvailable = true;
                DiamondsCount++;
            }
            else if (ClubsCount <= MaxCardsInOneSuit)
            {
                cardSuit = Clubs;
                cardNumber = ClubsCount;
                isAvailable = true;
                ClubsCount++;
            }
        }
    }

    class Card
    {
        public Card(int cardNumber, string cardSuit, bool isAvailable)
        {
            Number = cardNumber;
            Suit = cardSuit;
            IsAvailable = isAvailable;
        }

        public int Number { get; private set; }
        public string Suit { get; private set; }
        public bool IsAvailable { get; private set; }      

        public void MakeUnavailable()
        {
            IsAvailable = false;
        }
    }
}
